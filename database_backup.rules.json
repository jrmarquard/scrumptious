// Needs patching up.
// Hard to develop with strict rules in place. Likely just going to leave them
// open for now.

{
  "rules": {
    // Nobody can write to everything, nobody can read everything. 
    // These will be overwritten deeper in the rules.
    ".read": false,
    ".write": false,
    
    // List of projects
    "projects": {
      // A project
      "$projectId": {
        // Project read/write by anyone in the $projectID/users list
        // ".read": "root.child.('projects/' + $projectId + '/users/' + auth.uid).exists()",
        // ".write": "root.child.('projects/' + $projectId + '/users/' + auth.uid).exists()",
        
        // temp rules it's getting too late
        ".read" : "root.child($projectId).child('owner').val() === auth.id",
        ".write" : "root.child($projectId).child('owner').val() === auth.id",
        
        
        // Projects must have a title, an owner, and a users list
        ".validate": "newData.hasChildren(['title','users'])",
        "title": {
            // title can only be a string and <100 characters
          ".validate": "newData.isString() && newData.val().length < 100 && newData.val().length > 0",
        },
        // List of users in the project
        "users": {
          
        }
      },
    },
      
    // List of users
    "users": {
      ".read": true,
      ".write": true,
      ".indexOn": "userName",
      "$uid": {
        // User can read/write their own data.
        ".read": true,
        ".write": true,
        // User must have a name
        ".validate": "newData.hasChild('username')",
        "name": {
          ".validate": "newData.isString()",
        },
        "username": {
          ".validate": "newData.isString()",
        },
        "notifications": {
          "$notificationID":{
            
            }
        },
        // List of projects the user is 'in'
                "projects": {
        },
        // All other data is rejected
        "$other": {
          ".validate": false,
        }
      }      
    },
    
  }
}
